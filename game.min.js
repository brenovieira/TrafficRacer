!function(){"use strict";window.StoreManager={get:function(t){return localStorage.getItem(t)},put:function(t,e){return localStorage.setItem(t,e)},"delete":function(t){return localStorage.removeItem(t)},clear:function(){return localStorage.clear()}}}(),function(){"use strict";function t(t,e,i,s){this.x=t,this.y=e,this.width=i,this.height=s,this.index=0,this.score=0,this.isGone=!1}t.prototype.move=function(t,e,i){this.y+=this.speedY,this.y>i&&!this.isGone&&(this.isGone=!0,this.emitEvent("entityIsGone",{index:this.index,score:this.score}))},t.prototype.draw=function(t){throw Error("Draw must be implemented by Entity child")},t.prototype.crashWith=function(e){if(!(e instanceof t))throw Error("Argument must be an Entity");var i=this.getPosition(),s=e.getPosition(),n=5;return i.bottom-s.top>n&&s.bottom-i.top>n&&i.right-s.left>n&&s.right-i.left>n},t.prototype.getPosition=function(){return{left:this.x,right:this.x+this.width,top:this.y,bottom:this.y+this.height}},t.prototype.crashAction=function(){throw Error("CrashAction must be implemented by Entity child")},t.prototype.emitEvent=function(t,e){var i=new CustomEvent(t,{detail:e});document.dispatchEvent(i)},t.obstacles=0,t.prototype.speedX=0,t.prototype.speedY=0,window.Entity=t}(),function(t){"use strict";function e(e,i,s,n,o){t.call(this,e,i,s,n),this.index=t.obstacles++,this.score=100,this.image=new Image,this.image.src=o}e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.prototype.parent=t.prototype,e.prototype.draw=function(t){t.drawImage(this.image,this.x,this.y,this.width,this.height)},e.prototype.crashAction=function(){this.emitEvent("stop")},window.Car=e}(window.Entity),function(t){"use strict";function e(e,i,s,n){t.call(this,e,i,s,n),this.index=t.obstacles++,this.score=50,this.sentLoseScore=!1,this.centerX=e+.5*s,this.centerY=i+.5*n,this.radius=.5*Math.min(s,n)}e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.prototype.parent=t.prototype,e.prototype.move=function(t,e,i){this.centerY+=this.speedY,this.parent.move.call(this,arguments)},e.prototype.draw=function(t){t.beginPath(),t.arc(this.centerX,this.centerY,this.radius,0,2*Math.PI),t.fillStyle="black",t.fill()},e.prototype.crashAction=function(){this.sentLoseScore||(this.sentLoseScore=!0,this.emitEvent("loseScore"))},window.Hole=e}(window.Entity),function(t){"use strict";function e(e,i,s,n){t.call(this,e,i,s,n),this.index=t.obstacles++,this.score=50,this.image=new Image,this.image.src="oil.png"}e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.prototype.parent=t.prototype,e.prototype.draw=function(t){t.drawImage(this.image,this.x,this.y,this.width,this.height)},e.prototype.crashAction=function(){this.emitEvent("slide")},window.Oil=e}(window.Entity),function(t){"use strict";function e(e,i,s,n,o){t.call(this,e,i,s,n),this.speedX=0,this.speedY=0,this.laneWidth=o,this.image=new Image,this.image.src="car_red.png",document.addEventListener("keydown",this.keyDownHandler.bind(this),!1),document.addEventListener("keyup",this.keyUpHandler.bind(this),!1)}var i=37,s=39;e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.prototype.parent=t.prototype,e.prototype.move=function(t,e,i){this.x+this.speedX<t||this.x+this.width+this.speedX>e||(this.x+=this.speedX)},e.prototype.draw=function(t){t.drawImage(this.image,this.x,this.y,this.width,this.height)},e.prototype.keyDownHandler=function(t){t.keyCode==i?this.speedX=-.25*this.laneWidth:t.keyCode==s&&(this.speedX=.25*this.laneWidth)},e.prototype.keyUpHandler=function(t){t.keyCode==i?this.speedX=0:t.keyCode==s&&(this.speedX=0)},window.Player=e}(window.Entity),function(t){"use strict";function e(e,i,s,n){t.call(this,e,i,s,n),this.image=new Image,this.image.src="background.jpg"}e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.prototype.parent=t.prototype,e.prototype.move=function(t,e,i){this.y+=this.speedY,this.y>=this.height&&(this.y=0)},e.prototype.draw=function(t){t.drawImage(this.image,this.x,this.y,this.width,this.height),t.drawImage(this.image,this.x,this.y-this.height,this.width,this.height)},window.Background=e}(window.Entity),function(t){"use strict";function e(e,i,s,n,o){t.call(this,e,i,0,0),this.speedX=0,this.speedY=0,this.font=s,this.color=n,this.text=o||""}e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.prototype.parent=t.prototype,e.prototype.draw=function(t){t.font=this.font,t.fillStyle=this.color,t.fillText(this.text,this.x,this.y)},window.Text=e}(window.Entity),function(t,e,i,s,n,o,r,h){"use strict";var a={fps:30,initialSpeedY:6,numberOfFramesToCreateEntities:15,numberOfFramesToIncreaseSpeed:120,numberOfLanes:4,percentageToIncreaseSpeed:.15,running:!1,canvas:document.getElementById("canvas"),roadInitX:230,roadFinalX:530,entityWidth:60,entityHeight:80};a.context=a.canvas.getContext("2d"),a.laneWidth=(a.roadFinalX-a.roadInitX)/a.numberOfLanes,a.clear=function(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height)},a.start=function(){this.entities=[],this.frame=0,this.score=0,this.minIndexVisible=0,this.running=!0,this.validPositions=[];for(var e=0;e<this.numberOfLanes;e++)this.validPositions[e]=!0;this.background=new r(0,0,this.canvas.width,this.canvas.height),this.player=new o(this.roadInitX+2*this.laneWidth,this.canvas.height-this.entityHeight,this.entityWidth,this.entityHeight,this.laneWidth),this.gameOverText=null,this.scoreText=new h(600,30,"20px Consolas","black","Score: "+this.score);var i=t.get("highestScore")||0;this.highestScoreText=new h(600,60,"20px Consolas","black","Recorde: "+i),this.resetEntity()},a.draw=function(){if(!this.running)return void(this.gameOverText||(this.gameOverText=new h(.5*(this.roadInitX+this.roadFinalX),.5*this.canvas.height,"40px Consolas","red","Game Over"),this.gameOverText.draw(this.context)));this.clear(),this.background.draw(this.context),this.player.draw(this.context),this.scoreText.draw(this.context),this.highestScoreText.draw(this.context);for(var t=this.minIndexVisible;t<this.entities.length;t++)this.entities[t].draw(this.context)},a.update=function(){if(this.running){var t;for(t=this.minIndexVisible;t<this.entities.length;t++)this.entities[t].crashWith(this.player)&&this.entities[t].crashAction();for(this.frame++,this.shouldCreateNewEntities()&&this.createNewEntities(),this.shouldIncreaseSpeed()&&this.increaseSpeed(),this.background.move(this.roadInitX,this.roadFinalX,this.canvas.height),this.player.move(this.roadInitX,this.roadFinalX,this.canvas.height),t=this.minIndexVisible;t<this.entities.length;t++)this.entities[t].move(this.roadInitX,this.roadFinalX,this.canvas.height)}},a.shouldCreateNewEntities=function(){return 1===this.frame||this.frame/this.numberOfFramesToCreateEntities%1===0},a.createNewEntities=function(){var t,e=[],i=Math.floor(Math.random()*this.numberOfLanes);for(t=0;i>t;t++){for(var s;e[s=Math.floor(Math.random()*this.numberOfLanes)];);e[s]=!0}if(this.setValidPositions(e)){for(t=0;t<e.length;t++)if(e[t]){var n=this.createNewEntity(this.roadInitX+t*this.laneWidth,-1*this.entityHeight,this.entityWidth,this.entityHeight);this.entities.push(n)}}else for(this.validPositions=[],t=0;t<this.numberOfLanes;t++)this.validPositions[t]=!0};var c=1,d=2,p=3,l=4;a.createNewEntity=function(t,e,o,r){var h=4,a=Math.floor(Math.random()*h)+1;switch(a){case c:return new i(t,e,o,r,"car_yellow.png");case d:return new i(t,e,o,r,"car_pink.png");case p:return new n(t,e,o,r);case l:return new s(t,e,o,r);default:throw Error("Type of Obstacle not implemented")}},a.setValidPositions=function(t){for(var e=[],i=!1,s=0;s<this.numberOfLanes;s++)e[s]=this.getNewValidPosition(s,t),e[s]&&(i=!0);return this.validPositions=e,i},a.getNewValidPosition=function(t,e){return e[t]?!1:this.validPositions[t]?!0:t===this.numberOfLanes-1?!1:a.getNewValidPosition(t+1,e)},a.shouldIncreaseSpeed=function(){return this.frame/this.numberOfFramesToIncreaseSpeed%1===0},a.increaseSpeed=function(){e.prototype.speedY*=1+this.percentageToIncreaseSpeed},a.resetEntity=function(){e.prototype.speedY=this.initialSpeedY,e.obstacles=0},a.stop=function(e){this.running=!1;var i=t.get("highestScore")||0;t.put("highestScore",Math.max(i,this.score)),this.highestScoreText.text="Recorde: "+i},a.slide=function(t){this.player.x+this.player.width+this.laneWidth>this.roadFinalX?this.player.x-=this.laneWidth:this.player.x+=this.laneWidth},a.loseScore=function(t){this.score-=1e3},a.entityIsGone=function(t){var e=t.detail||{};this.score+=e.score||100,this.scoreText.text="Score: "+this.score,this.minIndexVisible=Math.max(this.minIndexVisible,e.index||0)},document.addEventListener("stop",a.stop.bind(a),!1),document.addEventListener("slide",a.slide.bind(a),!1),document.addEventListener("loseScore",a.loseScore.bind(a),!1),document.addEventListener("entityIsGone",a.entityIsGone.bind(a),!1),document.getElementById("startBtn").addEventListener("click",a.start.bind(a),!1),window.Game=a}(window.StoreManager,window.Entity,window.Car,window.Hole,window.Oil,window.Player,window.Background,window.Text);